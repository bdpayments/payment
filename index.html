<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>পেমেন্ট করুন</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Serif+Bengali:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Noto Serif Bengali', 'Inter', sans-serif;
            background: linear-gradient(to right, #8A2BE2, #9370DB);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
        }
        .bkash-bg {
            background-color: #E2136E;
        }
        .nagad-bg {
            background-color: #F68B25;
        }
        .bkash-text {
            color: #E2136E;
        }
        .nagad-text {
            color: #F68B25;
        }
        /* Spinning loader animation */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 1.5rem;
            height: 1.5rem;
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body>

    <div id="payment-container" class="bg-white rounded-xl shadow-lg p-6 md:p-8 max-w-lg w-full">
        <h1 class="text-3xl font-bold text-center mb-6 text-gray-800">পেমেন্ট করুন</h1>
        
        <form id="payment-form" class="space-y-6">
            <div>
                <label for="name" class="block text-gray-700 font-medium mb-2">আপনার নাম</label>
                <input type="text" id="name" name="আপনার নাম (Your Name)" placeholder="আপনার পুরো নাম লিখুন" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            </div>
            
            <div>
                <label for="email" class="block text-gray-700 font-medium mb-2">আপনার ইমেল</label>
                <input type="email" id="email" name="আপনার ইমেল (Your Email)" placeholder="email@example.com" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            </div>

            <div>
                <label for="amount" class="block text-gray-700 font-medium mb-2">টাকার পরিমাণ (BDT)</label>
                <input type="number" id="amount" name="amount" placeholder="যেমন: 500" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            </div>

            <div>
                <span class="block text-gray-700 font-medium mb-2">পেমেন্ট পদ্ধতি</span>
                <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4">
                    <label class="flex items-center space-x-2 border border-gray-300 rounded-lg p-4 cursor-pointer w-full hover:shadow-md transition-shadow duration-200">
                        <input type="radio" name="পেমেন্ট পদ্ধতি (Payment Method)" value="Bkash" class="form-radio h-5 w-5 bkash-text" required>
                        <img src="https://play-lh.googleusercontent.com/1CRcUfmtwvWxT2g-xJF8s9_btha42TLi6Lo-qVkVomXBb_citzakZX9BbeY51iholWs=w240-h480-rw" alt="Bkash Logo" class="h-8">
                        <span class="text-lg font-semibold text-gray-800">বিকাশ</span>
                    </label>
                    <label class="flex items-center space-x-2 border border-gray-300 rounded-lg p-4 cursor-pointer w-full hover:shadow-md transition-shadow duration-200">
                        <input type="radio" name="পেমেন্ট পদ্ধতি (Payment Method)" value="Nagad" class="form-radio h-5 w-5 nagad-text" required>
                        <img src="https://freelogopng.com/images/all_img/1679248787Nagad-Logo.png" alt="Nagad Logo" class="h-8">
                        <span class="text-lg font-semibold text-gray-800">নগদ</span>
                    </label>
                </div>
            </div>

            <div id="account-number-container" class="hidden mt-4 p-4 border border-gray-300 rounded-lg bg-gray-50 flex flex-col md:flex-row items-center justify-between">
                <p class="text-lg font-bold text-gray-800 mb-2 md:mb-0 md:mr-4">
                    আমাদের অ্যাকাউন্ট নম্বর:(Personal) <span id="account-number-display" class="font-mono text-blue-600"></span>
                </p>
                <button type="button" id="copy-button" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors duration-200">
                    কপি করুন
                </button>
            </div>

            <div>
                <label for="trxId" class="block text-gray-700 font-medium mb-2">ট্রানজেকশন আইডি</label>
                <input type="text" id="trxId" name="Trnx Id" placeholder="আপনার ট্রানজেকশন আইডি লিখুন" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            </div>
            
            <button id="submit-button" type="submit" class="w-full py-3 px-4 bg-blue-600 text-white font-bold rounded-lg shadow-md hover:bg-blue-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 flex items-center justify-center space-x-2">
                <span id="button-text">পেমেন্ট জমা দিন</span>
                <div id="button-spinner" class="hidden spinner"></div>
            </button>
        </form>
    </div>

    <footer class="mt-8 text-center text-sm text-gray-700">
        <p>© 2025 Payment solution by Talha it technologies. All rights reserved.</p>
    </footer>
    
    <div id="message-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-xl p-8 max-w-sm w-full text-center">
            <h2 id="message-title" class="text-2xl font-bold mb-4"></h2>
            <p id="message-text" class="text-gray-700 mb-6"></p>
            <button id="close-modal" class="w-full py-2 px-4 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700">বন্ধ করুন</button>
        </div>
    </div>
    
    <script>
        const form = document.getElementById('payment-form');
        const submitButton = document.getElementById('submit-button');
        const buttonText = document.getElementById('button-text');
        const buttonSpinner = document.getElementById('button-spinner');

        const modal = document.getElementById('message-modal');
        const modalTitle = document.getElementById('message-title');
        const modalText = document.getElementById('message-text');
        const closeModalButton = document.getElementById('close-modal');
        
        const paymentMethods = document.querySelectorAll('input[name="পেমেন্ট পদ্ধতি (Payment Method)"]');
        const accountNumberContainer = document.getElementById('account-number-container');
        const accountNumberDisplay = document.getElementById('account-number-display');
        const copyButton = document.getElementById('copy-button');
        const ACCOUNT_NUMBER = '01919129121';

        // Function to get a URL parameter by name
        function getUrlParameter(name) {
            name = name.replace(/[\[\]]/g, '\\$&');
            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)');
            var results = regex.exec(window.location.href);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }

        // Get the 'amount' parameter from the URL
        const amountFromUrl = getUrlParameter('amount');
        const amountInput = document.getElementById('amount');

        // If the amount parameter exists, set the input field value
        if (amountFromUrl !== null) {
            amountInput.value = amountFromUrl;
        }

        // Function to show the modal with a specific message
        function showModal(title, message) {
            modalTitle.textContent = title;
            modalText.textContent = message;
            modal.classList.remove('hidden');
        }

        // Function to close the modal
        closeModalButton.addEventListener('click', () => {
            modal.classList.add('hidden');
        });

        // Event listener to show account number and copy button when a payment method is selected
        paymentMethods.forEach(radio => {
            radio.addEventListener('change', (event) => {
                if (event.target.checked) {
                    accountNumberDisplay.textContent = ACCOUNT_NUMBER;
                    accountNumberContainer.classList.remove('hidden');
                }
            });
        });

        // Event listener for the copy button
        copyButton.addEventListener('click', () => {
            const tempInput = document.createElement('input');
            tempInput.value = ACCOUNT_NUMBER;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);

            // Give user feedback
            const originalButtonText = copyButton.textContent;
            copyButton.textContent = 'কপি হয়েছে!';
            setTimeout(() => {
                copyButton.textContent = originalButtonText;
            }, 2000);
        });

        // Handle form submission using fetch to send data to the script
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Show loading state
            submitButton.disabled = true;
            buttonText.textContent = 'প্রসেস হচ্ছে...';
            buttonSpinner.classList.remove('hidden');

            // Get form data
            const formData = new FormData(form);
            const scriptUrl = 'https://script.google.com/macros/s/AKfycbwptydkStFxYTyTXJ_4SSyS88nlikekqdKaSusYLkttSl7JpFpciSisnZ6VPFmnTHi9/exec';

            // Convert FormData to URL-encoded string
            const urlEncodedData = new URLSearchParams(formData).toString();

            try {
                // Submit form data using fetch with URL-encoded data
                const response = await fetch(scriptUrl, {
                    method: 'POST',
                    body: urlEncodedData,
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    mode: 'no-cors'
                });

                if (response.ok || response.type === 'opaque') {
                    showModal('পেমেন্ট সফল হয়েছে!', 'আপনার পেমেন্ট সফলভাবে জমা দেওয়া হয়েছে। আমরা খুব শীঘ্রই আপনার ট্রানজেকশন যাচাই করব।');
                    form.reset(); // Reset form fields on success
                } else {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

            } catch (error) {
                console.error("Error submitting form:", error);
                showModal('পেমেন্ট ব্যর্থ', 'পেমেন্ট জমা দিতে সমস্যা হয়েছে। অনুগ্রহ করে আবার চেষ্টা করুন।');
            } finally {
                // Hide loading state and enable button
                submitButton.disabled = false;
                buttonText.textContent = 'পেমেন্ট জমা দিন';
                buttonSpinner.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
